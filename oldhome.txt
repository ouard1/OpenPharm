import React from "react";
import {
  SearchProvider,
  SearchBox,
  Results,
  Facet,
  Paging,
  ResultsPerPage,
  ErrorBoundary
} from "@elastic/react-search-ui";
import  ElasticsearchAPIConnector  from '@elastic/search-ui-elasticsearch-connector';
import "@elastic/react-search-ui-views/lib/styles/styles.css";

// Elasticsearch connector configuration
const connector = new ElasticsearchAPIConnector({
  host: "https://localhost:9200",
  index: "medicine-index" ,
  
  connectionOptions: {
    headers: {
    Authorization: 'Basic ZWxhc3RpYzpQaTkqbk11UjQqPVVYNTcwT0NRNg==',
     },
    }

});

// Search UI configuration
const config = {
  searchQuery: {
    search_fields: {
      "labo": { weight: 1 },
      "cpharmaco": { weight: 1 },
      "ctherapeutique": { weight: 1 },
      "dci": { weight: 1 },
      "Nom Commercial": { weight: 1 }
    },
    result_fields: {
      "Nom Commercial": { snippet: {} }
    },
    disjunctiveFacets: [
      "cpharmaco.keyword",
      "ctherapeutique.keyword",
      "Type.keyword",
      "Pays.keyword"
    ],
    facets: {
      "cpharmaco.keyword": { type: "value" },
      "ctherapeutique.keyword": { type: "value" },
      "Type.keyword": { type: "value" },
      "Pays.keyword": { type: "value" }
    }
  },
  autocompleteQuery: {
    results: {
      resultsPerPage: 5,
      search_fields: {
        "labo": { weight: 1 },
        "cpharmaco": { weight: 1 },
        "ctherapeutique": { weight: 1 },
        "dci": { weight: 1 },
        "Nom Commercial": { weight: 1 }
      },
      result_fields: {
        "Nom Commercial": { snippet: { size: 100, fallback: true } }
      }
    },
    suggestions: {
      types: {
        results: { fields: ["Nom Commercial"] }
      },
      size: 4
    }
  },
  apiConnector: connector,
  alwaysSearchOnInitialLoad: true
};


const App = () => {
    console.log("Search UI Config:", config);
    console.log("Elasticsearch Connector:", connector);
  
    return (
      <SearchProvider config={config}>
        <ErrorBoundary>
          <div className="App">
            <header>
              <SearchBox
                autocompleteMinimumCharacters={3}
                autocompleteResults={{
                  linkTarget: "_blank",
                  sectionTitle: "Results",
                  titleField: "Nom Commercial",
                  urlField: "url",
                  shouldTrackClickThrough: true
                }}
                autocompleteSuggestions={true}
                debounceLength={0}
              />
            </header>
            <aside>
              <Facet key={"1"} field={"cpharmaco.keyword"} label={"cpharmaco"} />
              <Facet key={"2"} field={"ctherapeutique.keyword"} label={"ctherapeutique"} />
              <Facet key={"3"} field={"Type.keyword"} label={"Type"} />
              <Facet key={"4"} field={"Pays.keyword"} label={"Pays"} />
            </aside>
            <main>
              <Results
                shouldTrackClickThrough={true}
                titleField="Nom Commercial"
              />
              <Paging />
              <ResultsPerPage />
            </main>
          </div>
        </ErrorBoundary>
      </SearchProvider>
    );
  };
  
  export default App;